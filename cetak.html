<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Struk Transaksi - Caf√© Cerita Saja</title>
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/invoice.css">
</head>
<body>
  <div class="invoice-container">
    <!-- HEADER -->
    <div class="invoice-header">
      <h2>üßæ STRUK TRANSAKSI</h2>
    </div>
    
    <!-- INFO CAF√â -->
    <div class="cafe-info">
      <h3>‚òï CAF√â CERITA SAJA</h3>
      <p>Jl. Kopi Nikmat No. 123, Jakarta</p>
      <p>üìû 0812-xxxx-xxxx | üìß cafe@ceritasaja.com</p>
      <p>üåê @ceritasaja</p>
    </div>

    <!-- CONTENT -->
    <div class="invoice-content">
      <!-- TRANSACTION ID -->
      <div style="text-align: center; margin-bottom: 20px;">
        <div class="transaction-id">
          ID: <span id="transaction-id">CS20250805001</span>
        </div>
      </div>

      <!-- CUSTOMER INFO -->
      <table class="invoice-table">
        <tr>
          <td>üë§ Nama</td>
          <td>:</td>
          <td id="invoice-nama">
            <script>
              document.write(decodeURIComponent((location.search.match(/[\?&]nama=([^&]*)/)||[])[1]||'Nama tidak tersedia'));
            </script>
          </td>
        </tr>
        
        <tr>
          <td>üìÖ Tanggal</td>
          <td>:</td>
          <td id="invoice-tanggal">
            <script>
              document.write(decodeURIComponent((location.search.match(/[\?&]tanggal=([^&]*)/)||[])[1]||''));
            </script>
          </td>
        </tr>
        
        <tr>
          <td>‚è∞ Waktu</td>
          <td>:</td>
          <td id="invoice-waktu">
            <script>
              document.write(decodeURIComponent((location.search.match(/[\?&]waktu=([^&]*)/)||[])[1]||''));
            </script>
          </td>
        </tr>
        
        <tr>
          <td>ü™ë Meja</td>
          <td>:</td>
          <td id="invoice-meja">
            <script>
              const meja = decodeURIComponent((location.search.match(/[\?&]meja=([^&]*)/)||[])[1]||'');
              document.write(meja ? `Meja ${meja}` : 'Tidak dipilih');
            </script>
          </td>
        </tr>
        
        <tr>
          <td>üë• Jumlah Orang</td>
          <td>:</td>
          <td id="invoice-jumlah-orang">
            <script>
              document.write(decodeURIComponent((location.search.match(/[\?&]jumlah_orang=([^&]*)/)||[])[1]||'1'));
            </script>
          </td>
        </tr>
      </table>

      <!-- PRODUCT LIST -->
      <div class="product-list">
        <h4 style="color: #8B4513; margin-bottom: 15px; text-align: center;">üõçÔ∏è PESANAN</h4>
        <div id="invoice-products">
          <script>
            var params = new URLSearchParams(window.location.search);
            var produk = params.getAll('produk[]');
            var hasil = [];
            var total = 0;
            
            var harga = {
              'Kopi Hitam': 15000,
              'Caf√© Latte': 20000,
              'Roti Bakar': 10000
            };
            
            if(produk.length) {
              produk.forEach(function(item) {
                var jumlah = 0;
                var hargaItem = harga[item] || 0;
                
                switch(item) {
                  case 'Kopi Hitam':
                    jumlah = parseInt(params.get('jumlah_kopi')) || 0;
                    break;
                  case 'Caf√© Latte':
                    jumlah = parseInt(params.get('jumlah_latte')) || 0;
                    break;
                  case 'Roti Bakar':
                    jumlah = parseInt(params.get('jumlah_roti')) || 0;
                    break;
                }
                
                if(jumlah > 0) {
                  var subtotal = hargaItem * jumlah;
                  total += subtotal;
                  
                  document.write(`
                    <div class="product-item-invoice">
                      <div>
                        <span class="product-name">${item}</span>
                        <span class="product-quantity">x${jumlah}</span>
                      </div>
                      <div class="product-price">Rp ${subtotal.toLocaleString('id-ID')}</div>
                    </div>
                  `);
                }
              });
            } else {
              document.write('<div style="text-align: center; color: #666;">Tidak ada produk yang dipilih</div>');
            }
          </script>
        </div>
      </div>

      <!-- PAYMENT INFO -->
      <div class="payment-info">
        <div class="payment-method" id="invoice-pembayaran">
          üí≥ <script>
            document.write(decodeURIComponent((location.search.match(/[\?&]pembayaran=([^&]*)/)||[])[1]||'Tidak dipilih'));
          </script>
        </div>
      </div>

      <!-- TOTAL SECTION -->
      <div class="total-section">
        <div class="total-row">
          <span>Subtotal:</span>
          <span id="calculated-total">Rp 0</span>
        </div>
        <div class="total-row">
          <span>Pajak (10%):</span>
          <span id="tax-amount">Rp 0</span>
        </div>
        <div class="total-row total-final">
          <span>TOTAL BAYAR:</span>
          <span id="invoice-total">
            <script>
              document.write(decodeURIComponent((location.search.match(/[\?&]total=([^&]*)/)||[])[1]||'Rp 0'));
            </script>
          </span>
        </div>
      </div>

      <!-- NOTES -->
      <table class="invoice-table" style="margin-top: 20px;">
        <tr>
          <td>üìù Catatan</td>
          <td>:</td>
          <td id="invoice-catatan">
            <script>
              const catatanValue = decodeURIComponent((location.search.match(/[\?&]catatan=([^&]*)/)||[])[1]||'');
              document.write(catatanValue || 'Tidak ada catatan khusus');
            </script>
          </td>
        </tr>
      </table>

      <!-- QR CODE SECTION -->
      <div class="qr-section">
        <h4>üì± Scan untuk Review</h4>
        <div class="qr-code">
          [QR CODE]
        </div>
        <small>Berikan review untuk pelayanan kami</small>
      </div>
    </div>

    <!-- FOOTER -->
    <div class="invoice-footer">
      <div class="thank-you">üôè Terima Kasih Atas Kunjungan Anda!</div>
      <div class="footer-note">
        Simpan struk ini sebagai bukti pembayaran<br>
        Selamat menikmati dan sampai jumpa lagi! ‚òï
      </div>
    </div>
  </div>

  <!-- PRINT BUTTON -->
  <div style="text-align: center; margin: 20px;">
    <button id="print-button" class="print-button" onclick="window.print()">
      üñ®Ô∏è Cetak Struk
    </button>
    <button class="print-button" onclick="window.location.href='transaksi.html'" style="background: #6c757d;">
      üîô Transaksi Baru
    </button>
  </div>

  <!-- Load JavaScript -->
  <script src="js/invoice.js"></script>
  
  <script>
    // Hitung pajak dan update total
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(function() {
        const calculatedTotalElement = document.getElementById('calculated-total');
        if (calculatedTotalElement) {
          const subtotalText = calculatedTotalElement.textContent;
          const subtotal = parseInt(subtotalText.replace(/[^\d]/g, '')) || 0;
          const tax = Math.round(subtotal * 0.1);
          const finalTotal = subtotal + tax;
          
          document.getElementById('tax-amount').textContent = `Rp ${tax.toLocaleString('id-ID')}`;
          
          // Update total jika perlu
          const totalElement = document.getElementById('invoice-total');
          if (totalElement.textContent === 'Rp 0' || !totalElement.textContent.includes('Rp')) {
            totalElement.textContent = `Rp ${finalTotal.toLocaleString('id-ID')}`;
          }
        }
      }, 500);
    });
  </script>
            document.write(decodeURIComponent((location.search.match(/[\?&]tanggal=([^&]*)/)||[])[1]||''));
          </script>
        </td>
      </tr>
      <tr>
        <td>Waktu</td>
        <td>:</td>
        <td>
          <script>
            document.write(decodeURIComponent((location.search.match(/[\?&]waktu=([^&]*)/)||[])[1]||''));
          </script>
        </td>
      </tr>
      <tr>
        <td>Nomor Meja</td>
        <td>:</td>
        <td>
          <script>
            document.write(decodeURIComponent((location.search.match(/[\?&]meja=([^&]*)/)||[])[1]||''));
          </script>
        </td>
      </tr>
      <tr>
        <td>Jumlah Orang</td>
        <td>:</td>
        <td>
          <script>
            document.write(decodeURIComponent((location.search.match(/[\?&]jumlah_orang=([^&]*)/)||[])[1]||''));
          </script>
        </td>
      </tr>
      <tr>
        <td>Catatan</td>
        <td>:</td>
        <td>
          <script>
            var catatan = decodeURIComponent((location.search.match(/[\?&]catatan=([^&]*)/)||[])[1]||'');
            // Hilangkan + dan ganti dengan spasi agar "tanpa+gula" jadi "tanpa gula"
            document.write(catatan.replace(/\+/g, ' '));
          </script>
        </td>
      </tr>
      <tr>
        <td><b>Total</b></td>
        <td>:</td>
        <td>
          <b>Rp 
            <script>
              document.write(decodeURIComponent((location.search.match(/[\?&]total=([^&]*)/)||[])[1]||''));
            </script>
          </b>
        </td>
      </tr>
    </table>
    <br>
    <small>Terima kasih telah bertransaksi di Caf√© Cerita Saja.</small>
    <br><br>
    <a href="index.html"><button>Kembali ke Beranda</button></a>
  </center>
</body>
</html>
